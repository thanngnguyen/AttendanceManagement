@model List<AttendanceManagement.Models.Class>
@{
    ViewData["Title"] = "Lớp học của tôi";
}

<div class="glass-bg-purple">
    <div class="container">
        <!-- Header -->
        <div class="glass-card mb-4">
            <div class="glass-header">
                <div class="d-flex justify-content-between align-items-center flex-wrap gap-3">
                    <h2 class="mb-0">
                        <i class="fas fa-chalkboard icon-glow"></i> Lớp học của tôi
                    </h2>
                    @if (User.IsInRole("Teacher") || User.IsInRole("Admin"))
                    {
                        <a asp-action="Create" class="btn btn-gradient-success">
                            <i class="fas fa-plus"></i> Tạo lớp mới
                        </a>
                    }
                    else
                    {
                        <a asp-action="Join" class="btn btn-gradient-info">
                            <i class="fas fa-plus"></i> Tham gia lớp
                        </a>
                    }
                </div>
            </div>
        </div>

        @if (Model.Count == 0)
        {
            <div class="glass-card text-center">
                <div class="glass-body" style="padding: 60px 40px;">
                    <i class="fas fa-inbox fa-5x icon-glow mb-4" style="color: rgba(255,255,255,0.6);"></i>
                    <h4 class="text-white mb-3">Chưa có lớp học nào</h4>
                    <p class="text-glass mb-4">
                        @if (User.IsInRole("Teacher") || User.IsInRole("Admin"))
                        {
                            <text>Hãy tạo lớp học đầu tiên của bạn!</text>
                        }
                        else
                        {
                            <text>Hãy tham gia một lớp học bằng mã lớp!</text>
                        }
                    </p>
                    @if (User.IsInRole("Teacher") || User.IsInRole("Admin"))
                    {
                        <a asp-action="Create" class="btn btn-gradient-primary btn-lg">
                            <i class="fas fa-plus-circle"></i> Tạo lớp học ngay
                        </a>
                    }
                    else
                    {
                        <a asp-action="Join" class="btn btn-gradient-info btn-lg">
                            <i class="fas fa-sign-in-alt"></i> Tham gia lớp ngay
                        </a>
                    }
                </div>
            </div>
        }
        else
        {
            <div class="row g-4">
                @foreach (var classItem in Model)
                {
                    <div class="col-md-6 col-lg-4">
                        <div class="glass-card-sm h-100" style="overflow: hidden;">
                            <!-- Banner/Image -->
                            @if (!string.IsNullOrEmpty(classItem.BannerImageUrl))
                            {
                                <div style="height: 150px; overflow: hidden; border-radius: 20px 20px 0 0; margin: -25px -25px 20px -25px;">
                                    <img src="@classItem.BannerImageUrl" alt="@classItem.ClassName" 
                                         style="width: 100%; height: 100%; object-fit: cover;">
                                </div>
                            }
                            else
                            {
                                <div style="height: 150px; background: linear-gradient(135deg, rgba(102, 126, 234, 0.3), rgba(118, 75, 162, 0.3)); 
                                            border-radius: 20px 20px 0 0; margin: -25px -25px 20px -25px; 
                                            display: flex; align-items: center; justify-content: center;">
                                    <i class="fas fa-chalkboard fa-5x icon-glow" style="color: rgba(255,255,255,0.7);"></i>
                                </div>
                            }
                            
                            <!-- Content -->
                            <div class="d-flex flex-column" style="height: calc(100% - 170px);">
                                <h5 class="text-white mb-3" style="font-weight: 700;">@classItem.ClassName</h5>
                                
                                @if (!string.IsNullOrEmpty(classItem.Subject))
                                {
                                    <div class="glass-box mb-2">
                                        <i class="fas fa-book"></i> @classItem.Subject
                                    </div>
                                }
                                
                                @if (!string.IsNullOrEmpty(classItem.Room))
                                {
                                    <div class="glass-box mb-2">
                                        <i class="fas fa-door-open"></i> Phòng @classItem.Room
                                    </div>
                                }
                                
                                <div class="glass-box mb-2">
                                    <i class="fas fa-user-tie"></i> @classItem.Teacher.FullName
                                </div>
                                
                                <div class="glass-box mb-3">
                                    <i class="fas fa-users"></i> @classItem.Enrollments.Count(e => e.IsActive) sinh viên
                                </div>

                                @if (!string.IsNullOrEmpty(classItem.Description))
                                {
                                    <p class="text-glass small mb-3" style="
                                        display: -webkit-box;
                                        -webkit-line-clamp: 2;
                                        -webkit-box-orient: vertical;
                                        overflow: hidden;">
                                        @classItem.Description
                                    </p>
                                }
                                
                                <!-- Footer -->
                                <div class="mt-auto">
                                    <div class="glass-box mb-3" style="background: rgba(255,255,255,0.15); text-align: center;">
                                        <small class="text-glass-muted">Mã lớp:</small>
                                        <strong class="text-white d-block" style="font-size: 1.1rem; letter-spacing: 1px;">
                                            @classItem.ClassCode
                                        </strong>
                                    </div>
                                    
                                    <a asp-action="Detail" asp-route-id="@classItem.ClassId" class="btn btn-gradient-primary w-100">
                                        <i class="fas fa-arrow-right"></i> Vào lớp học
                                    </a>
                                </div>
                            </div>
                        </div>
                    </div>
                }
            </div>
        }
    </div>
</div>
